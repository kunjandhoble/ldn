<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Subscribe</title>
    <link href={% static "css/bootstrap.min.css" %} rel="stylesheet">
    <link href={% static  "css/customOne.css" %} type="text/css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="text/javascript" src={% static "js/jquery-2.1.4.min.js" %}></script>
    <script type="text/javascript" src={% static "js/bootstrap.min.js" %}></script>
    <style>
        .xcomponent-outlet {
            width: 375px !important;
            height: 80px !important;
            margin: 0 auto;
        }

        .paypal-button-logo1 {
            height: 28px !important;
        }

        .paypal-button-container {
            font-size: 17px !important;
        }
    </style>
    <script>
        $(document).ready(function () {
            $(".loader").hide();

        });

        window.onload = function () {
            document.getElementById('paypal-button').className = 'xcomponent-outlet';

        };
    </script>
</head>

<body>
<div class="blue-bg-nav">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <header class="header-tp">
                    <nav class="navbar navbar-default navbar-static-top">
                        <div class="container-fluid">
                            <div class="navbar-header">
                                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                                        data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                                    <span class="sr-only">Toggle navigation</span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                </button>
                                <div class="">
                                    <a href="#" class="btn-blu mrgn-top" data-toggle="modal" data-target="#at-helping">
                                        <img src={% static "Images/ldn-research-trust-logo.png" %} alt="logoImage0"/>
                                    </a>
                                </div>
                            </div>
                            <div id="navbar" class="navbar-collapse collapse">
                                <form class="form-inline">
                                    <ul class="nav navbar-nav navbar-right bdr">
                                        <li><a href="{% url 'logout' %}" class="btn-blu mrgn-top">LOGOUT</a>
                                        </li>
                                    </ul>
                                </form>
                            </div>
                        </div>
                    </nav>
                </header>
            </div>
        </div>
    </div>
</div>
<div class="band">
    <div class="bandleft"></div>
    <div class="bandright"></div>
</div>
<style>
    .loader {
        align-content: center;
        width: 13em;
        height: 13em;
        animation: loaderAnim 1.25s infinite;
        outline: 1px solid transparent;
    }

    .loader #largeBox {
        height: 13em;
        width: 13em;
        background-color: #ececec;
        outline: 1px solid transparent;
        position: fixed;
    }

    .loader #smallBox {
        height: 13em;
        width: 13em;
        background-color: #34495e;
        position: fixed;
        z-index: 1;
        outline: 1px solid transparent;
        animation: smallBoxAnim 1.25s alternate infinite ease-in-out;
    }

    @keyframes smallBoxAnim {
        0% {
            transform: scale(0.2);
        }
        100% {
            transform: scale(0.75);
        }
    }

    @keyframes loaderAnim {
        0% {
            transform: rotate(0deg);
        }
        100% {
            transform: rotate(90deg);
        }
    }


</style>
<div class="login-wrap_Bg">
    <div id="fullscreen_bg" class="fullscreen_bg"/>
    <div id="regContainer" class="container">
        <div class="row">
            <div class="col-md-7 col-md-offset-3">
                <div class="panel panel-login">
                    <div class="panel-heading">

                    </div>
                    <div class="panel-body">

                        <div class="row">
                            {% if error %}
                                <div id="error">{{ error }}</div>
                            {% endif %}
                            <div class="col-lg-12" style="color:#fff">
                                <h2>Your registration has been approved!</h2>
                                <p style="font-family: 'latoregular'; font-size: 18px; line-height: 26px;">Please
                                    complete your signup and subscribe
                                    to LDN Hub for the introductory offer of <strong>Â£300</strong> to get instant access
                                    to <strong>unlimited
                                        patient data*</strong> until January 2019!</p>
                                {% csrf_token %}
                                <div id="paypal-button" style="text-align:center"></div>
                                <p style="font-family: 'latoregular';font-size: 11px;">*Unlimited Patient Data refers to
                                    an unlimited number of your
                                    patients who use the myLDN app and give permission for you to view their data.</p>
                            </div>
                        </div>
                        <div class="loader">
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{#<div>#}
{#    <h3 style="text-align:center; margin-top: 150px"><b>Please pay GBP 300.00 to avail subscription till 1st Jan,#}
{#        2019</b></h3>#}
{#</div>#}

<script src="https://www.paypalobjects.com/api/checkout.js"></script>
<script type="text/javascript" src={% static "js/jquery-2.1.4.min.js" %}></script>
<script>
    paypal.Button.render({

        {#        env: 'production', // Or 'sandbox'#}
        env: 'sandbox',

        client: {
            {#            client id#}
            sandbox: 'Abk-JdQX-f9BuSvuhU2sJg9QFMF-sMDGr5e86bqdLXfhASVNeQn9xds7o4vYAp2V9sYVX9TtgW5CqJBc'
            {#            production: 'xxxxxxxxx'#}
        },

        commit: true, // Show a 'Pay Now' button

        payment: function (data, actions) {
            return actions.payment.create({
                payment: {
                    transactions: [
                        {
                            amount: {total: '300.00', currency: 'GBP'}
                        }
                    ]
                }
            });
        },

        onAuthorize: function (data, actions) {
            {#            window.alert("Please click OK and wait for a while for transaction to proceed.");#}
            $(".col-lg-12").hide()
            $(".loader").append("<div id=" + "largeBox" + "></div><div id=" + "smallBox" + "></div>" + "<p style=" + "font-family: 'latoregular'; font-size: 18px; line-height: 26px;" + ">" + "<strong>WE ARE PROCESSING YOUR PAYMENT. PLEASE DO NOT REFRESH OR HIT BACK BUTTON.</strong></p>");

            $(".loader").show();
            var csrftoken = jQuery("[name=csrfmiddlewaretoken]").val();

            function csrfSafeMethod(method) {
                // these HTTP methods do not require CSRF protection
                return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
            }

            $.ajaxSetup({
                beforeSend: function (xhr, settings) {
                    if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                        xhr.setRequestHeader("X-CSRFToken", csrftoken);
                    }
                }
            });
            $.ajax({

                type: "POST",
                url: "{% url 'checkpayment' %}",
                dataType: "json",
                data: data,

                success: function (data) {
                    console.log(data); // log the returned json to the console
                    if (data.error) {
                        console.log("failed"); // another sanity check
                        alert("Payment Failed");
                    }
                    else {
                        console.log("success"); // another sanity check
{#                        alert("Payment Completed");#}
                        location.href = data.url;

                    }

                },
                error: console.log("error in ajax call")
                {#            return actions.payment.execute().then(function(payment) {#}

                // The payment is complete!
                // You can now show a confirmation message to the customer
                {#                window.alert("Payment Complete")#}
            });
        }

    }, '#paypal-button');
</script>
</body>

</html>